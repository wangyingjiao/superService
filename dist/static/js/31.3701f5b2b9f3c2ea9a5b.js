webpackJsonp([31],{"CM/I":function(e,t,a){t=e.exports=a("FZ+f")(!1),t.push([e.i,".treecss .el-tree-node .el-tree-node__children .el-tree-node .el-tree-node__children .el-tree-node__children .el-tree-node,.treecss .el-tree-node .el-tree-node__children .el-tree-node__children .el-tree-node{float:left}.ceshi{height:25px;width:80px}.dialog-footer{text-align:center}.scrollBox{height:400px;overflow-y:scroll;overflow-x:hidden}.diasize .el-dialog{width:60%}",""])},J9kW:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"diatable diasize",attrs:{title:e.textMap[e.dialogStatus],visible:e.dialogFormVisible,"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,id:"diatable"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"temp",staticClass:"small-space dia_form",attrs:{model:e.temp,"label-position":"left",rules:e.rules,"label-width":"160px"}},[a("el-form-item",{attrs:{label:"所属机构:",prop:"officeId"}},[a("el-select",{staticClass:"form_item",attrs:{disabled:e.selsctState,filterable:"",placeholder:"请选择"},on:{change:e.orgChange},model:{value:e.temp.officeId,callback:function(t){e.temp.officeId=t},expression:"temp.officeId"}},e._l(e.officeIds,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"岗位名称:",prop:"name"}},[a("el-input",{staticClass:"form_item",attrs:{placeholder:"请输入2-15位的岗位名称"},model:{value:e.temp.name,callback:function(t){e.temp.name="string"==typeof t?t.trim():t},expression:"temp.name"}})],1),e._v(" "),a("el-form-item",{staticClass:"treecss",attrs:{label:"权限:",prop:"check"}},[a("el-tree",{ref:"domTree",staticClass:"scrollBox form_item",attrs:{data:e.treeData,indent:30,"show-checkbox":"","node-key":"id","filter-node-method":e.filterNode,"default-expand-all":!0,props:e.defaultProps},on:{"check-change":e.handTreechange,"node-click":e.nodeClick,"current-change":e.currentChange,"node-expand":e.nodeExpand,"node-collapse":e.nodeCollapse},model:{value:e.temp.check,callback:function(t){e.temp.check=t},expression:"temp.check"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",slot:"footer"},["update"==e.dialogStatus&&e.myselfUpdate?a("button",{staticClass:"button-large btn-color",attrs:{disabled:e.btnState},on:{click:function(t){e.update("temp")}}},[e._v("保 存")]):e._e(),e._v(" "),"create"==e.dialogStatus?a("button",{staticClass:"button-large btn-color",attrs:{disabled:e.btnState},on:{click:function(t){e.create("temp")}}},[e._v("保 存")]):e._e(),e._v(" "),a("button",{staticClass:"button-cancel btn-color-cancel",on:{click:function(t){e.resetForm("temp")}}},[e._v("取 消")])])],1)},i=[],r={render:s,staticRenderFns:i};t.a=r},VGlQ:function(e,t,a){var s=a("CM/I");"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);a("rjj0")("0be3db0c",s,!0)},Vc3t:function(e,t,a){"use strict";function s(){var e={};return l.a.get("sign")?e=JSON.parse(l.a.get("sign")):n.a.get("/apiservice/oss/getSign").then(function(t){var a=t.data;l.a.set("sign",r()(a)),e=JSON.parse(l.a.get("sign"))}),e}t.a=s;var i=a("mvHQ"),r=a.n(i),n=a("Vo7i"),o=a("lbHh"),l=a.n(o)},oppB:function(e,t,a){"use strict";function s(e){return M.a.post("/apiservice/a/sys/user/saveData",e)}function i(e){return M.a.post("/apiservice/a/sys/user/upData",e)}function r(e){return M.a.post("/apiservice/a/sys/user/formData",e)}function n(e,t,a){return M.a.post("/apiservice/a/sys/role/listPageData?pageNo="+t+"&pageSize="+a,e)}function o(e){return M.a.post("/apiservice/a/sys/role/listDataWithoutPermission",e)}function l(e,t,a){return M.a.post("/apiservice/a/sys/user/listData?pageNo="+t+"&pageSize="+a,e)}function d(e){return M.a.post("/apiservice/a/sys/role/saveData",e)}function c(e){return M.a.post("/apiservice/a/sys/role/upData",e)}function u(e){return M.a.post("/apiservice/a/sys/role/deleteRole",e)}function f(e){return M.a.get("/apiservice/a/sys/role/getRoleDetail?id="+e)}function h(e){return M.a.post("/apiservice/a/sys/organization/getOrgByTypeOrgId",e)}function p(e){return M.a.post("/apiservice/a/service/station/serviceStation/listStationByOrgId",e)}function m(e){return M.a.post("/apiservice/a/sys/organization/listDataAll",e)}function g(e){return M.a.post("/apiservice/a/service/station/serviceStation/listByOffice",e)}function v(){return M.a.get("/apiservice/a/sys/menu/getMenuList")}function b(e){return M.a.post("/apiservice/a/sys/user/deleteUser",e)}function y(e){return M.a.get("/apiservice/a/sys/role/chkName?id="+e.id+"&name="+e.name)}t.k=s,t.l=i,t.g=r,t.p=n,t.j=o,t.e=l,t.n=d,t.o=c,t.q=u,t.m=f,t.f=h,t.i=p,t.b=m,t.c=g,t.a=v,t.h=b,t.d=y;var M=a("Vo7i")},qn0T:function(e,t,a){"use strict";var s=a("BO1k"),i=a.n(s),r=a("lbHh"),n=(a.n(r),a("oppB"));a("Vc3t");t.a={name:"role-dialog",data:function(){return{btnShow:JSON.parse(localStorage.getItem("btn")),btnState:!1,selsctState:!1,myselfUpdate:!0,officeIds:[],treeData:[],temp:{name:"",dataScope:"10",check:[],officeId:""},stationLv:[{id:"1",value:"一级"},{id:"2",value:"二级"},{id:"3",value:"三级"},{id:"4",value:"四级"},{id:"5",value:"五级"},{id:"6",value:"六级"},{id:"7",value:"七级"},{id:"8",value:"八级"},{id:"9",value:"九级"},{id:"10",value:"十级"}],roleLv:[],filterText:"",dialogFormVisible:!1,dialogStatus:"",textMap:{update:"编辑岗位",create:"新增岗位"},defaultProps:{children:"subMenus",label:"name"},rules:{officeId:[{required:!0,message:"机构不能为空",trigger:"change"}],name:[{required:!0,message:"岗位名称不能为空",trigger:"blur"},{min:2,max:15,message:"长度在 2 到 15 个字符",trigger:"blur"}],dataScope:[{required:!0,message:"等级不能为空",trigger:"change"}],check:[{type:"array",required:!0,message:"权限不能为空",trigger:"check-change"}]}}},computed:{},created:function(){var e=this;a.i(n.a)().then(function(t){e.treeData=t.data.data}),a.i(n.b)({}).then(function(t){void 0!=t.data.data.list&&(e.officeIds=t.data.data.list)})},props:["diaState","rowData","getlistByDia"],watch:{filterText:function(e){this.$refs.domTree.filter(e)}},methods:{filterNode:function(e,t){return!e||-1!==t.type.indexOf(e)},orgChange:function(e){var t=this;"sys"==e?this.$nextTick(function(){t.filterText=""}):this.$nextTick(function(){t.filterText="business"})},handleCreate:function(){var e=this;this.listLoading=!0,a.i(n.b)({}).then(function(t){e.officeIds=t.data.data.list,a.i(n.a)().then(function(t){e.data2=t.data.data,1==t.data.code?(e.dialogStatus="create",e.dialogFormVisible=!0,"platform"==localStorage.getItem("type")?(e.filterText="",e.$nextTick(function(){e.filterText="business"})):e.filterText="",e.listLoading=!1,1==e.officeIds.length&&(e.temp.officeId=e.officeIds[0].id)):e.listLoading=!1})}).catch(function(){e.listLoading=!1})},handleUpdate:function(e){var t=this;this.myselfUpdate=!0,this.listLoading=!0,a.i(n.m)(e.id).then(function(e){if(t.listLoading=!1,1==e.data.code){for(var a=e.data.data.menuListUnion,s=0;s<a.length;s++)if(void 0!=a[s].subMenus)for(var i=a[s].subMenus,r=0;r<i.length;r++)if(void 0!=i[r].subMenus)for(var n=i[r].subMenus,o=0;o<n.length;o++){var l=n[o];void 0!=l.permission&&"order_info"==l.permission&&void 0==l.disabled&&(n.remove(l),n.push(l))}for(var s=0;s<a.length;s++)if(void 0!=a[s].subMenus)for(var i=a[s].subMenus,r=0;r<i.length;r++)if(void 0!=i[r].subMenus)for(var n=i[r].subMenus,o=0;o<n.length;o++){var l=n[o];if(void 0!=l.permission&&"view"==l.permission.substring(l.permission.length-4,l.permission.length)&&void 0==l.disabled){n.remove(l),n.push(l)}}t.data2=a,"yes"==e.data.data.updateOwnFlag&&(t.myselfUpdate=!1),e.data.data.flagRoleId&&(t.myselfUpdate=!1,t.$nextTick(function(){t.myselfUpdate=!1})),t.dialogStatus="update",t.dialogFormVisible=!0;var d=e.data.data;t.roleId=d.id,setTimeout(function(){t.temp.officeId=d.organization.id},50),"platform"==localStorage.getItem("type")?(t.filterText="",t.$nextTick(function(){t.filterText="business"})):t.filterText="",t.temp.name=d.name,t.temp.dataScope="10",t.temp.check=d.menuIdListEdit,e.data.data.flag&&(t.selsctState=!0);for(var c=0;c<t.data2.length;c++)if("index"==t.data2[c].permission||t.temp.check.remove(t.data2[c].id),void 0!=t.data2[c].subMenus)for(var u=t.data2[c],f=0;f<u.subMenus.length;f++)t.temp.check.remove(u.subMenus[f].id);t.$nextTick(function(){t.$refs.domTree.setCheckedKeys(t.temp.check)})}else t.listLoading=!1})},nodeClick:function(e,t,a){},currentChange:function(e,t){},nodeExpand:function(e,t,a){},nodeCollapse:function(e,t,a){},handTreechange:function(e,t,a){if(t){if(["order_time","order_dispatch","order_addTech","order_cancel"].indexOf(e.permission)>-1)for(var s=e.parentIds.split(","),i=0;i<this.treeData.length;i++)if(void 0!=this.treeData[i].subMenus)for(var r=0;r<this.treeData[i].subMenus.length;r++)"order"==this.treeData[i].subMenus[r].permission&&this.$refs.domTree.setChecked(this.treeData[i].subMenus[r].subMenus[this.treeData[i].subMenus[r].subMenus.length-2].id,!0);if(void 0==e.subMenus)for(var s=e.parentIds.split(","),i=0;i<this.treeData.length;i++)if(void 0!=this.treeData[i].subMenus)for(var r=0;r<this.treeData[i].subMenus.length;r++)if(this.treeData[i].subMenus[r].id==s[3]){var n=this.treeData[i].subMenus[r].subMenus[this.treeData[i].subMenus[r].subMenus.length-1];if(void 0!=n.permission){var o=n.permission,l=o.substring(o.length-4,o.length);"view"==l&&this.$refs.domTree.setChecked(n.id,!0)}}}else{if("order_info"==e.permission)for(var i=0;i<this.treeData.length;i++)if(void 0!=this.treeData[i].subMenus)for(var r=0;r<this.treeData[i].subMenus.length;r++)if("order"==this.treeData[i].subMenus[r].permission)for(var d=this.treeData[i].subMenus[r],c=0;c<d.subMenus.length-2;c++)this.temp.check.indexOf(d.subMenus[c].id)>-1&&(this.$refs.domTree.setChecked(this.treeData[i].subMenus[r].subMenus[d.subMenus.length-2].id,!0),this.temp.check=this.$refs.domTree.getCheckedKeys());if("view"==e.permission.substring(e.permission.length-4,e.permission.length))for(var u=e.parentIds.split(","),i=0;i<this.treeData.length;i++)if(void 0!=this.treeData[i].subMenus)for(var r=0;r<this.treeData[i].subMenus.length;r++)if(this.treeData[i].subMenus[r].id==u[3])for(var c=0;c<this.treeData[i].subMenus[r].subMenus.length-1;c++)this.temp.check.indexOf(this.treeData[i].subMenus[r].subMenus[c].id)>-1&&this.$refs.domTree.setChecked(this.treeData[i].subMenus[r].subMenus[this.treeData[i].subMenus[r].subMenus.length-1].id,!0)}this.temp.check=this.$refs.domTree.getCheckedKeys()},forOfTree:function(){var e=[],t=!0,a=!1,s=void 0;try{for(var r,n=i()(this.data2);!(t=(r=n.next()).done);t=!0){var o=r.value;if("sys"==o.type){e.push(o.id);var l=!0,d=!1,c=void 0;try{for(var u,f=i()(o.subMenus);!(l=(u=f.next()).done);l=!0){var h=u.value;if(e.push(h.id),h.subMenus){var p=!0,m=!1,g=void 0;try{for(var v,b=i()(h.subMenus);!(p=(v=b.next()).done);p=!0){var y=v.value;e.push(y.id)}}catch(e){m=!0,g=e}finally{try{!p&&b.return&&b.return()}finally{if(m)throw g}}}}}catch(e){d=!0,c=e}finally{try{!l&&f.return&&f.return()}finally{if(d)throw c}}}}}catch(e){a=!0,s=e}finally{try{!t&&n.return&&n.return()}finally{if(a)throw s}}return e},create:function(e){var t=this,s=this.$refs.domTree.getCheckedKeys(),r="";if("business"==this.filterText){var o=this.forOfTree(),l=!0,d=!1,c=void 0;try{for(var u,f=i()(o);!(l=(u=f.next()).done);l=!0){var h=u.value;s.remove(h)}}catch(e){d=!0,c=e}finally{try{!l&&f.return&&f.return()}finally{if(d)throw c}}}0==s.length&&(this.temp.check=[]);for(var h=0;h<s.length;h++)r+=s[h]+",";var p={name:this.temp.name,dataScope:"10",menuIds:r,useable:"1",organization:{id:this.temp.officeId}};this.$refs[e].validate(function(s){if(!s){for(var i=t.$refs[e]._data.fields,r=[],o=0;o<i.length;o++)""!=i[o].validateMessage&&r.push(i[o].validateMessage);return t.$message({type:"error",message:r[0]}),!1}t.btnState=!0,a.i(n.n)(p).then(function(a){t.btnState=!1,1===a.data.code&&(t.resetTemp(),t.$refs[e].resetFields(),t.$refs.domTree.setCheckedKeys([]),t.$message({type:"success",message:"添加成功"}),t.dialogFormVisible=!1,t.$emit("getlistByDia","create",a))}).catch(function(e){t.btnState=!1})})},update:function(e){var t=this,s=this.$refs.domTree.getCheckedKeys(),r="";if("business"==this.filterText){var o=this.forOfTree(),l=!0,d=!1,c=void 0;try{for(var u,f=i()(o);!(l=(u=f.next()).done);l=!0){var h=u.value;s.remove(h)}}catch(e){d=!0,c=e}finally{try{!l&&f.return&&f.return()}finally{if(d)throw c}}}0==s.length&&(this.temp.check=[]);for(var h=0;h<s.length;h++)r+=s[h]+",";var p={id:this.roleId,name:this.temp.name,dataScope:this.temp.dataScope,menuIds:r,useable:"1",organization:{id:this.temp.officeId}};this.$refs[e].validate(function(s){if(!s){for(var i=t.$refs[e]._data.fields,r=[],o=0;o<i.length;o++)""!=i[o].validateMessage&&r.push(i[o].validateMessage);return t.$message({type:"error",message:r[0]}),!1}t.btnState=!0,a.i(n.o)(p).then(function(a){t.btnState=!1,1===a.data.code&&(t.selsctState=!1,t.resetTemp(),t.$refs.domTree.setCheckedKeys([]),t.$refs[e].resetFields(),t.dialogFormVisible=!1,t.$message({type:"success",message:"修改成功"}),t.$emit("getlistByDia","update"))}).catch(function(e){t.btnState=!1})})},resetTemp:function(){this.temp={officeId:"",name:"",dataScope:"10",check:[]}},resetForm:function(e){this.selsctState=!1,this.dialogFormVisible=!1,this.$refs.domTree.setCheckedKeys([]),this.$refs[e].resetFields(),this.resetTemp()}}}},zfsD:function(e,t,a){"use strict";function s(e){a("VGlQ")}Object.defineProperty(t,"__esModule",{value:!0});var i=a("qn0T"),r=a("J9kW"),n=a("VU/8"),o=s,l=n(i.a,r.a,o,null,null);t.default=l.exports}});