webpackJsonp([20],{"/ObC":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"img-list"},[e._l(e.imagelist,function(t,a){return i("div",{key:a,staticClass:"img-content"},[i("img",{attrs:{src:e.imgWhole.imgPath+t.url+e.imgWhole.imgSuffix}}),e._v(" "),i("div",{staticClass:"layer"},[i("i",{staticClass:"el-icon-delete",on:{click:function(i){e.handleFileRemove(t,a)}}})])])}),e._v(" "),e.pass||0===e.progress?e._e():i("div",{staticClass:"img-content img-progress"},[i("el-progress",{attrs:{type:"circle",percentage:e.progress,status:e.proStatus}})],1),e._v(" "),e.imgFlag?i("div",{staticClass:"img-upload"},[i("el-upload",{ref:"upload",staticClass:"uploader",attrs:{accept:"image/*","list-type":"picture-card","show-file-list":!1,action:e.params.action,data:e.params.data,"on-change":e.uploadOnChange,"http-request":e.uploadOnSuccess,"before-upload":e.beforeUpload,"on-error":e.uploadOnError,"on-progress":e.uploadOnProgress}},[i("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1):e._e()],2)},s=[],n={render:a,staticRenderFns:s};t.a=n},"5Nd6":function(e,t,i){var a=i("C6sG");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);i("rjj0")("04dc6e58",a,!0)},C6sG:function(e,t,i){t=e.exports=i("FZ+f")(!1),t.push([e.i,"*{box-sizing:border-box}.img-list{overflow:hidden;width:100%}.img-list .img-content{background-color:#fff;float:left;text-align:left;position:relative;display:inline-block;padding:5px;margin:5px 20px 20px 0;border:1px solid #d1dbe5;border-radius:4px;transition:all .3s;box-shadow:0 2px 4px 0 rgba(0,0,0,.12),0 0 6px 0 rgba(0,0,0,.04)}.img-list .img-upload{float:left;display:table;text-align:center}.img-upload .uploader .el-upload--picture-card{width:112px;height:112px;line-height:112px;margin-top:5px}.img-list .uploader{width:100%;display:table-cell;vertical-align:middle}.img-list .img-progress{text-align:center;padding-top:50px}.img-list .img-content img{display:block;margin:0 auto;border-radius:4px}.img-list .img-content .name{margin-top:10px}.img-list .img-content .name>div{width:90%;text-overflow:ellipsis;overflow:hidden;height:25px;line-height:25px}.img-list .img-content:hover .del,.img-list .img-content:hover .layer{opacity:1}.img-list .img-content .del,.img-list .img-content .layer{opacity:0;transition:all .3s}.img-list .img-content .del{position:absolute;bottom:10px;right:10px;color:#8492a6;cursor:pointer;font-size:1.1em}.img-list .img-content .layer{line-height:112px;position:absolute;left:0;right:0;top:0;height:112px;color:#fff;text-align:center;z-index:5;background-color:rgba(0,0,0,.4)}.img-list .img-content .layer i{font-size:1.6em}",""])},Vc3t:function(e,t,i){"use strict";function a(){var e={};return r.a.get("sign")?e=JSON.parse(r.a.get("sign")):o.a.get("/apiservice/oss/getSign").then(function(t){console.log(t.data,"签名");var i=t.data;r.a.set("sign",n()(i)),e=JSON.parse(r.a.get("sign"))}),e}t.a=a;var s=i("mvHQ"),n=i.n(s),o=i("Vo7i"),l=i("lbHh"),r=i.n(l)},b6LW:function(e,t,i){"use strict";function a(e){i("5Nd6")}Object.defineProperty(t,"__esModule",{value:!0});var s=i("ii9V"),n=i("/ObC"),o=i("VU/8"),l=a,r=o(s.a,n.a,l,null,null);t.default=r.exports},ii9V:function(e,t,i){"use strict";var a=i("mvHQ"),s=i.n(a),n=i("//Fk"),o=i.n(n),l=i("lbHh"),r=i.n(l),g=i("Vc3t");t.a={name:"upload-list",data:function(){return{progress:0,pass:null,isEnlargeImage:!1,imgFlag:!0,enlargeImage:"",imagelist:[],params:{action:"http://jsonplaceholder.typicode.com/posts/",data:{}},imgWhole:{imgPath:"https://imgcdn.guoanshequ.com/",imgSuffix:"?x-oss-process=image/resize,m_fill,h_100,w_100"}}},computed:{proStatus:function(){return this.pass?"success":0==this.pass?"exception":""},sign:function(){return console.log("-------------------------------"),i.i(g.a)()}},watch:{piclist:{immediate:!0,handler:function(e,t){this.imagelist=e,e.length>3?this.imgFlag=!1:this.imgFlag=!0,console.log(e,"val++++++++")},deep:!0}},props:["piclist"],methods:{uploadOnProgress:function(e,t){console.log("------------------------------------"),console.log(e.percent,t),this.progress=Math.floor(e.percent)},beforeUpload:function(e){if("image/gif"!=e.type&&"image/jpg"!=e.type&&"image/png"!=e.type&&"image/jpeg"!=e.type)return this.$message.error("请上传正确的图片格式"),!1;if(this.imagelist.length>=4)return this.$message({type:"error",message:"最多上传4张图片"}),!1;var t=this;return new o.a(function(i,a){var s=new Image,n=new FileReader;document.createElement("canvas");n.onload=function(e){s.src=e.target.result},s.onload=function(e){var n=s.width,o=s.height;n>=750&&o/n>=.9&&o/n<=1.1?i(!0):(t.$message.error("为了保证浏览效果，请上传大于750px*750px的正方形图片"),a(!1))},n.readAsDataURL(e)})},uploadOnChange:function(e){console.log("——————————change——————————"),"ready"==e.status?(console.log("ready"),this.pass=null,this.progress=0):"fail"==e.status&&this.$message.error("图片上传出错，请刷新重试！")},uploadOnSuccess:function(e){var t=this,i=e.file.name.split("."),a=this;new o.a(function(e,i){console.log(JSON.parse(r.a.get("sign")),"测试1111");var a=JSON.parse(r.a.get("sign")),n=Date.parse(new Date)/1e3;a.expire-3>n?e(a):t.$http.get("/apiservice/oss/getSign").then(function(t){r.a.set("sign",s()(t.data)),e(t.data)})}).then(function(s){var n=s,o=new FormData,l=new Date,r=(l.getTime(),l.getFullYear()),g=l.getMonth()+1,c=l.getDate();o.append("name",e.file.name),o.append("key",n.dir+"/"+r+"/"+g+"/"+c+"/"+e.file.uid+"."+i[i.length-1]),o.append("policy",n.policy),o.append("OSSAccessKeyId",n.accessid),o.append("success_action_status",201),o.append("signature",n.signature),o.append("file",e.file,e.file.name),a.$http.post(n.host,o,{header:{"Content-Type":"multipart/form-data; boundary={boundary}"}}).then(function(e){var i=o.get("key");t.imagelist.push({url:i}),t.$emit("imgclick",t.imagelist),console.log(t.imagelist,"this.imagelist------------")}).catch(function(e){var i=o.get("key");t.imagelist.push({url:i}),t.imagelist.length>3&&(t.imgFlag=!1),t.$emit("imgclick",t.imagelist),console.log(t.imagelist,"this.imagelist------------")})})},uploadOnError:function(e,t){console.log("——————————error——————————"),console.log(e),this.pass=!1},handleFileEnlarge:function(e){console.log(e),e&&(this.enlargeImage=e,this.isEnlargeImage=!this.isEnlargeImage)},handleFileName:function(e,t){var i=this;console.log(e,t);var a=this;this.$prompt("请输入新文件名：","提示：",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(e){var s=e.value;if(console.log(s),!s)return!1;i.$message.success("操作成功"),a.imagelist[t].name=s}).catch(function(){})},handleFileRemove:function(e,t){if(console.log(e,t),!e.url)return!1;this.imagelist.splice(t,1),console.log(this.imagelist.length,"this.imagelist.length-----"),this.imagelist.length<4&&(this.imgFlag=!0),this.$emit("imgclick",this.imagelist)}}}}});