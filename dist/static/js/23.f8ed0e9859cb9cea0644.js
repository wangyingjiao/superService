webpackJsonp([23],{"2rLn":function(e,t,i){t=e.exports=i("FZ+f")(!1),t.push([e.i,".img-list[data-v-a5354ebc]{overflow:hidden;width:100%}.img-list .img-content[data-v-a5354ebc]{background-color:#fff;float:left;text-align:left;position:relative;display:inline-block;padding:5px;margin:0 20px 0 0;border:1px solid #d1dbe5;border-radius:4px;transition:all .3s;box-shadow:0 2px 4px 0 rgba(0,0,0,.12),0 0 6px 0 rgba(0,0,0,.04)}.img-list .img-upload[data-v-a5354ebc]{float:left;display:table;text-align:center}.img-upload .uploader .el-upload--picture-card[data-v-a5354ebc]{width:112px;height:112px;line-height:112px}.img-list .uploader[data-v-a5354ebc]{width:100%;display:table-cell;vertical-align:middle}.img-list .img-progress[data-v-a5354ebc]{text-align:center;padding-top:50px}.img-list .img-content img[data-v-a5354ebc]{display:block;margin:0 auto;border-radius:4px}.img-list .img-content .name[data-v-a5354ebc]{margin-top:10px}.img-list .img-content .name>div[data-v-a5354ebc]{width:90%;text-overflow:ellipsis;overflow:hidden;height:25px;line-height:25px}.img-list .img-content:hover .del[data-v-a5354ebc],.img-list .img-content:hover .layer[data-v-a5354ebc]{opacity:1}.img-list .img-content .del[data-v-a5354ebc],.img-list .img-content .layer[data-v-a5354ebc]{opacity:0;transition:all .3s}.img-list .img-content .del[data-v-a5354ebc]{position:absolute;bottom:10px;right:10px;color:#8492a6;cursor:pointer;font-size:1.1em}.img-list .img-content .layer[data-v-a5354ebc]{line-height:112px;position:absolute;left:0;right:0;top:0;height:112px;color:#fff;text-align:center;z-index:5;background-color:rgba(0,0,0,.4)}.img-list .img-content .layer i[data-v-a5354ebc]{font-size:1.6em}",""])},"7ted":function(e,t,i){var a=i("2rLn");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);i("rjj0")("72f89ba9",a,!0)},"F+99":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"img-list"},[e._l(e.imagelist,function(t,a){return i("div",{key:a,staticClass:"img-content"},[i("img",{attrs:{src:"picture"==e.type?e.imgWhole.imgPath+t.url:e.imgWhole.imgPath+t.url+e.imgWhole.imgSuffix}}),e._v(" "),i("div",{staticClass:"layer"},[i("i",{staticClass:"el-icon-delete",on:{click:function(i){e.handleFileRemove(t,a)}}})])])}),e._v(" "),e.pass||0===e.progress?e._e():i("div",{staticClass:"img-content img-progress"},[i("el-progress",{attrs:{type:"circle",percentage:e.progress,status:e.proStatus}})],1),e._v(" "),e.imgFlag?i("div",{staticClass:"img-upload"},[i("el-upload",{ref:"upload",staticClass:"uploader",attrs:{accept:"image/*","list-type":e.type,"show-file-list":!1,action:e.params.action,data:e.params.data,"on-change":e.uploadOnChange,"http-request":e.uploadOnSuccess,"before-upload":e.beforeUpload,"on-error":e.uploadOnError,"on-progress":e.uploadOnProgress}},[i("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1):e._e()],2)},s=[],n={render:a,staticRenderFns:s};t.a=n},Vc3t:function(e,t,i){"use strict";function a(){var e={};return r.a.get("sign")?e=JSON.parse(r.a.get("sign")):o.a.get("/apiservice/oss/getSign").then(function(t){console.log(t.data,"签名");var i=t.data;r.a.set("sign",n()(i)),e=JSON.parse(r.a.get("sign"))}),e}t.a=a;var s=i("mvHQ"),n=i.n(s),o=i("Vo7i"),l=i("lbHh"),r=i.n(l)},b6LW:function(e,t,i){"use strict";function a(e){i("7ted")}Object.defineProperty(t,"__esModule",{value:!0});var s=i("ii9V"),n=i("F+99"),o=i("VU/8"),l=a,r=o(s.a,n.a,l,"data-v-a5354ebc",null);t.default=r.exports},ii9V:function(e,t,i){"use strict";var a=i("mvHQ"),s=i.n(a),n=i("//Fk"),o=i.n(n),l=i("lbHh"),r=i.n(l),g=i("Vc3t");t.a={name:"upload-list",data:function(){return{progress:0,pass:null,isEnlargeImage:!1,imgFlag:!0,enlargeImage:"",imagelist:[],params:{action:"http://jsonplaceholder.typicode.com/posts/",data:{}},imgWhole:{imgPath:"https://imgcdn.guoanshequ.com/",imgSuffix:"?x-oss-process=image/resize,m_fill,h_100,w_100"}}},computed:{proStatus:function(){return this.pass?"success":0==this.pass?"exception":""},sign:function(){return i.i(g.a)()}},watch:{piclist:{immediate:!0,handler:function(e,t){this.imagelist=e,e.length>3?this.imgFlag=!1:this.imgFlag=!0,console.log(e,"val++++++++")},deep:!0}},props:["piclist","type","min","max"],methods:{uploadOnProgress:function(e,t){console.log("------------------------------------"),console.log(e.percent,t),this.progress=Math.floor(e.percent)},beforeUpload:function(e){if("image/gif"!=e.type&&"image/jpg"!=e.type&&"image/png"!=e.type&&"image/jpeg"!=e.type)return this.$message.error("请上传正确的图片格式"),!1;if(this.imagelist.length>=4)return this.$message({type:"error",message:"最多上传4张图片"}),!1;var t=this;return new o.a(function(i,a){var s=new Image,n=new FileReader;document.createElement("canvas");n.onload=function(e){s.src=e.target.result},s.onload=function(e){var n=s.width,o=s.height,l=t.min,r=t.max;console.log(l,"min"),console.log(r,"max"),n>=750&&o/n>=l&&o/n<=r?i(!0):(t.$message.error("上传图片不符合要求"),a(!1))},n.readAsDataURL(e)})},uploadOnChange:function(e){console.log("——————————change——————————"),"ready"==e.status?(console.log("ready"),this.pass=null,this.progress=0):"fail"==e.status&&this.$message.error("图片上传出错，请刷新重试！")},uploadOnSuccess:function(e,t,i,a){var n=this;console.log(e,"file-------"),console.log(t,"fileList--------"),console.log(i,"a--------"),console.log(a,"b---------");var l=e.file.name.split("."),g=this;new o.a(function(e,t){console.log(JSON.parse(r.a.get("sign")),"测试1111");var i=JSON.parse(r.a.get("sign")),a=Date.parse(new Date)/1e3;i.expire-3>a?e(i):n.$http.get("/apiservice/oss/getSign").then(function(t){r.a.set("sign",s()(t.data)),e(t.data)})}).then(function(t){var i=t,a=new FormData,s=new Date,o=(s.getTime(),s.getFullYear()),r=s.getMonth()+1,c=s.getDate();a.append("name",e.file.name),a.append("key","openservice/"+o+"/"+r+"/"+c+"/"+e.file.uid+"."+l[l.length-1]),a.append("policy",i.policy),a.append("OSSAccessKeyId",i.accessid),a.append("success_action_status",201),a.append("signature",i.signature),a.append("file",e.file,e.file.name),g.$http.post(i.host,a,{header:{"Content-Type":"multipart/form-data; boundary={boundary}"}}).then(function(e){var t=a.get("key");n.imagelist.push({url:t}),n.$emit("imgclick",n.imagelist),console.log(n.imagelist,"this.imagelist------------")}).catch(function(e){var t=a.get("key");n.imagelist.push({url:t}),n.imagelist.length>3&&(n.imgFlag=!1),n.$emit("imgclick",n.imagelist),console.log(n.imagelist,"this.imagelist------------")})})},uploadOnError:function(e,t){console.log("——————————error——————————"),console.log(e),this.pass=!1},handleFileEnlarge:function(e){console.log(e),e&&(this.enlargeImage=e,this.isEnlargeImage=!this.isEnlargeImage)},handleFileName:function(e,t){var i=this;console.log(e,t);var a=this;this.$prompt("请输入新文件名：","提示：",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(e){var s=e.value;if(console.log(s),!s)return!1;i.$message.success("操作成功"),a.imagelist[t].name=s}).catch(function(){})},handleFileRemove:function(e,t){if(console.log(e,t),!e.url)return!1;this.imagelist.splice(t,1),console.log(this.imagelist.length,"this.imagelist.length-----"),this.imagelist.length<4&&(this.imgFlag=!0),this.$emit("imgclick",this.imagelist)}}}}});